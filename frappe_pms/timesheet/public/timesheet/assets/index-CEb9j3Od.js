var xe=Object.defineProperty,pe=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var Q=(r,n,s)=>n in r?xe(r,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[n]=s,k=(r,n)=>{for(var s in n||(n={}))fe.call(n,s)&&Q(r,s,n[s]);if(K)for(var s of K(n))ge.call(n,s)&&Q(r,s,n[s]);return r},O=(r,n)=>pe(r,je(n));import{c as ve,b as I,u as g,r as f,g as C,a as E,d as B,e as L,p as F,f as be,j as e,C as ye,T as U,B as v,S as q,h as V,i as X,s as ee,k as se,A as ke,l as _e,m as Ne,n as Y,o as Se,q as Te}from"./index-C1dL3-sP.js";import{u as te,t as ae,D as $,a as P,b as W,c as z,F as re,d as S,e as T,f as w,g as D,h as A,i as we,C as De,S as Ae,T as ne,j as ie,k as Ce,l as Fe,m as Ve,A as Oe,n as Me,o as Re,p as Ie,q as Le,r as qe}from"./form-BOwT1959.js";import{I as Ee,L as le,S as Be}from"./input-CYSuPJFJ.js";/**
 * @license lucide-react v0.408.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=ve("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ue=()=>{var G,H,J;const{call:r}=I("timesheet_enhancer.api.timesheet.save"),{call:n}=I("timesheet_enhancer.api.timesheet.delete"),s=g(a=>a.timesheet),[l,p]=f.useState((G=s.timesheet.task)!=null?G:""),[d,h]=f.useState(C(s.timesheet.date)),_=g(a=>a.user),c=g(a=>a.user),m=E(),{toast:u}=B(),i=te({resolver:ae(Fe),defaultValues:{name:s.timesheet.name,task:s.timesheet.task,hours:s.timesheet.hours,description:s.timesheet.description,date:s.timesheet.date,parent:s.timesheet.parent,is_update:s.timesheet.isUpdate,employee:(J=(H=s.timesheet)==null?void 0:H.employee)!=null?J:c.employee},mode:"onSubmit"}),{data:b,mutate:N,error:y}=L("timesheet_enhancer.api.utils.get_task_for_employee",{employee:i.getValues("employee"),search:l},"task_for_employee",{errorRetryCount:1}),{data:t,mutate:o}=L("timesheet_enhancer.api.timesheet.get_remaining_hour_for_employee",{employee:_.employee,date:d});f.useEffect(()=>{if(y){const a=F(y);u({variant:"destructive",description:a})}},[y]);const j=()=>{i.reset(),m(q(!1))},oe=a=>{a&&(i.setValue("date",C(a)),h(C(a)))},ce=a=>{a instanceof Array?i.setValue("task",a[0]):i.setValue("task",a)},de=a=>{const x=a.target.value;i.setValue("hours",x)},he=a=>{p(a)},me=a=>{r(a).then(x=>{u({variant:"success",description:x.message}),m(V(!0)),j()}).catch(x=>{const R=F(x);u({variant:"destructive",description:R})})},ue=()=>{const a={name:i.getValues("name"),parent:i.getValues("parent")};n(a).then(x=>{u({variant:"success",description:x.message}),m(V(!0)),j()}).catch(x=>{const R=F(x);u({variant:"destructive",description:R})})};f.useEffect(()=>{N()},[l,N]),f.useEffect(()=>{o()},[d]);const M=f.useMemo(()=>be(s.data.working_hour,s.data.working_frequency),[]);return e.jsx($,{open:s.isDialogOpen,onOpenChange:j,children:e.jsxs(P,{className:"max-w-xl",children:[e.jsx(W,{children:e.jsx(z,{className:"pb-6",children:s.timesheet.hours>0?"Edit Time":"Add Time"})}),e.jsx(re,O(k({},i),{children:e.jsx("form",{onSubmit:i.handleSubmit(me),children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex gap-x-4",children:[e.jsx(S,{control:i.control,name:"hours",render:({field:a})=>e.jsxs(T,{className:"w-full",children:[e.jsx(w,{children:"Time"}),e.jsx(D,{children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(Ee,O(k({placeholder:"0h",className:"placeholder:text-slate-400 focus-visible:ring-0 focus-visible:ring-offset-0"},a),{type:"text",onChange:de})),e.jsx(ye,{className:"h-4 w-4 absolute right-0 m-3 top-0 stroke-slate-400"})]}),t&&e.jsx("div",{className:"flex gap-x-4",children:e.jsx("div",{className:"flex gap-1 justify-center items-center",children:e.jsx(U,{variant:"p",className:`${Number(t==null?void 0:t.message)<M?"text-success":"text-destructive"}`,children:`${Math.abs(M-Number(t==null?void 0:t.message))} hrs ${M-Number(t==null?void 0:t.message)>=0?"remaining":"extended"}`})})})]})}),e.jsx(A,{})]})}),e.jsx(S,{control:i.control,name:"date",render:({field:a})=>e.jsxs(T,{className:"w-full",children:[e.jsx(w,{children:"Date"}),e.jsx(D,{children:e.jsx(we,{date:a.value,onDateChange:oe,disabled:s.timesheet.task.length>0})}),e.jsx(A,{})]})})]}),e.jsx(S,{control:i.control,name:"task",render:()=>e.jsxs(T,{children:[e.jsx(w,{children:"Tasks"}),e.jsx(D,{children:e.jsx(De,{label:"Search Task",showSelected:!0,disabled:s.timesheet.task.length>0,value:i.getValues("task")?[i.getValues("task")]:[],data:b==null?void 0:b.message.map(a=>({label:a.subject,value:a.name,description:a.project_name,disabled:!1})),onSelect:ce,onSearch:he,rightIcon:e.jsx(Ae,{className:"h-4 w-4 stroke-slate-400"})})}),e.jsx(A,{})]})}),e.jsx(S,{control:i.control,name:"description",render:({field:a})=>e.jsxs(T,{children:[e.jsx(w,{children:"Comment"}),e.jsx(D,{children:e.jsx(ne,k({placeholder:"Explain your progress",rows:4,className:"w-full placeholder:text-slate-400 focus-visible:ring-0 focus-visible:ring-offset-0"},a))}),e.jsx(A,{})]})}),e.jsxs(ie,{className:"sm:justify-start w-full",children:[e.jsxs("div",{className:"flex gap-x-4 w-full",children:[e.jsxs(v,{disabled:i.formState.isSubmitting,children:[i.formState.isSubmitting&&e.jsx(le,{className:"animate-spin w-4 h-4"}),s.timesheet.hours>0?"Edit Time":"Add Time"]}),e.jsx(v,{variant:"secondary",type:"button",onClick:j,children:"Cancel"})]}),s.timesheet.hours>0&&e.jsx($e,{onDelete:ue})]})]})})}))]})})},$e=({onDelete:r})=>e.jsxs($,{children:[e.jsx(Ce,{asChild:!0,children:e.jsxs(v,{variant:"destructive",className:"float-right gap-x-1",type:"button",children:[e.jsx(Z,{className:"h-4 w-4 stroke-white"}),"Delete"]})}),e.jsxs(P,{className:"max-w-sm",children:[e.jsx(W,{children:e.jsx(z,{children:"Delete Time"})}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(U,{variant:"p",children:"Are you sure you want to delete this time entry?"}),e.jsx("div",{className:"flex gap-x-4",children:e.jsxs(v,{variant:"destructive",className:"float-right px-2 gap-x-1",type:"button",onClick:r,children:[e.jsx(Z,{className:"h-4 w-4 stroke-white"}),"Delete"]})})]})]})]}),Pe=()=>{const r=g(c=>c.timesheet),n=g(c=>c.user),s=E(),{toast:l}=B(),{call:p}=I("timesheet_enhancer.api.timesheet.submit_for_approval"),d=te({resolver:ae(Ve),defaultValues:{start_date:r.dateRange.start_date,end_date:r.dateRange.end_date,employee:n.employee,notes:""},mode:"onSubmit"}),h=()=>{d.reset(),s(ee({start_date:"",end_date:""})),s(V(!0)),s(se(!1))},_=c=>{p(c).then(m=>{l({variant:"success",description:m.message}),h()}).catch(m=>{const u=F(m);l({variant:"destructive",description:u})})};return e.jsx($,{open:r.isAprrovalDialogOpen,onOpenChange:h,children:e.jsxs(P,{children:[e.jsx(W,{children:e.jsxs(z,{className:"pb-6",children:["Week of ",X(r.dateRange.start_date).date," -",X(r.dateRange.end_date).date]})}),e.jsx(re,O(k({},d),{children:e.jsxs("form",{onSubmit:d.handleSubmit(_),children:[e.jsx(S,{control:d.control,name:"notes",render:({field:c})=>e.jsxs(T,{className:"w-full",children:[e.jsx(w,{children:"Note"}),e.jsx(D,{children:e.jsx(ne,k({placeholder:"Add a note",rows:4,className:"w-full placeholder:text-slate-400 focus-visible:ring-0 focus-visible:ring-offset-0"},c))}),e.jsx(A,{})]})}),e.jsx(ie,{className:"sm:justify-start mt-6",children:e.jsxs(v,{disabled:d.formState.isSubmitting,children:[d.formState.isSubmitting&&e.jsx(le,{className:"animate-spin w-4 h-4"}),"Submit For Approval"]})})]})}))]})})};function Je(){var b,N,y;const{toast:r}=B(),n=g(t=>t.user),s=g(t=>t.timesheet),l=E(),{data:p,isLoading:d,error:h,mutate:_}=L("timesheet_enhancer.api.timesheet.get_timesheet_data",{employee:n.employee,start_date:s.weekDate,max_week:4});f.useEffect(()=>{var t,o;if(s.isFetchAgain&&(_(),l(V(!1))),p&&((t=s.data)!=null&&t.data&&Object.keys((o=s.data)==null?void 0:o.data).length>0?l(ke(p.message)):l(_e(p.message))),h){const j=F(h);r({variant:"destructive",description:j})}},[p,h,s.isFetchAgain]);const c=()=>{const t={name:"",parent:"",task:"",date:C(new Date),description:"",hours:0,isUpdate:!1,employee:n.employee};l(Y(t)),l(q(!0))},m=t=>{t.employee=n.employee,t.isUpdate=t.hours>0,l(Y(t)),l(q(!0))},u=()=>{const t=s.data.data;if(!t)return;const o=t[Object.keys(t).pop()];l(Se(C(Te(o.start_date,-1)))),l(V(!0))},i=(t,o)=>{l(ee({start_date:t,end_date:o})),l(se(!0))};return h?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{children:e.jsx(v,{className:"float-right mb-1",onClick:c,children:"Add Time"})}),d?e.jsx(Be,{isFull:!0}):e.jsx("div",{className:"overflow-y-scroll",style:{height:"calc(100vh - 8rem)"},children:((b=s.data)==null?void 0:b.data)&&Object.keys((N=s.data)==null?void 0:N.data).length>0&&Object.entries((y=s.data)==null?void 0:y.data).map(([t,o])=>e.jsx(Oe,{type:"multiple",defaultValue:[t],children:e.jsxs(Me,{value:t,children:[e.jsx(Re,{className:"hover:no-underline w-full py-2",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs(U,{variant:"h6",className:"font-normal",children:[t,": ",Ne(o.total_hours),"h"]}),e.jsx(Ie,{start_date:o.start_date,end_date:o.end_date,onApproval:i,status:o.status})]})}),e.jsx(Le,{className:"pb-0",children:e.jsx(qe,{working_hour:s.data.working_hour,working_frequency:s.data.working_frequency,dates:o.dates,holidays:s.data.holidays,leaves:s.data.leaves,tasks:o.tasks,onCellClick:m})})]})},t))}),e.jsx("div",{className:"mt-5",children:e.jsx(v,{className:"float-left",variant:"outline",onClick:u,children:"Load More"})}),s.isDialogOpen&&e.jsx(Ue,{}),s.isAprrovalDialogOpen&&e.jsx(Pe,{})]})}export{Je as default};
